import{j as e,m as $}from"./ui-vendor-b6549631.js";import{r as o,b as M,L as S}from"./react-vendor-8bc290bc.js";import{listConversations as D,deleteConversation as P,updateConversationTitle as A}from"./conversationService-d7030955.js";import{c as z}from"./createLucideIcon-5c1ba45b.js";import{C as R}from"./chevron-left-652eb2a4.js";import{P as U,M as W}from"./plus-20f50b05.js";import{U as _}from"./user-6c757496.js";import{C as H}from"./check-81231a18.js";import{S as J}from"./star-9cb4629b.js";import"./config-1594e6a6.js";const K=z("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]),L=z("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),O=o.forwardRef(({selectedEngine:s="11",isOpen:x=!0,onToggle:i},j)=>{const h=M(),[w,N]=o.useState([]),[m,v]=o.useState([]),[p,f]=o.useState(!0),[u,d]=o.useState({open:!1,conversationId:null,title:""}),[r,b]=o.useState(()=>typeof window<"u"?window.innerWidth<768:!1);o.useEffect(()=>{c()},[s]),o.useEffect(()=>{const t=()=>{console.log("ðŸ”„ ì‚¬ì´ë“œë°” ìƒˆë¡œê³ ì¹¨ ì´ë²¤íŠ¸ ìˆ˜ì‹ "),c()};return window.addEventListener("refreshSidebar",t),()=>window.removeEventListener("refreshSidebar",t)},[s]),o.useEffect(()=>{const t=()=>{const n=window.innerWidth<768,F=r;b(n),!F&&n&&x&&(i==null||i())},l=window.innerWidth<768;return b(l),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[x,i,r]);const c=async()=>{try{f(!0);const t=await D(s);console.log(`ðŸ“Š ì‚¬ì´ë“œë°” ëŒ€í™” ëª©ë¡ (${s}):`,{totalCount:t.length,first5:t.slice(0,5).map(n=>({id:n.conversationId,title:n.title,updatedAt:n.updatedAt,engineType:n.engineType}))}),N(t);const l=JSON.parse(localStorage.getItem("favorites")||"[]");v(l)}catch(t){console.error("ëŒ€í™” ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:",t)}finally{f(!1)}};o.useImperativeHandle(j,()=>({loadConversations:c}));const a=t=>{const l=m.includes(t)?m.filter(n=>n!==t):[...m,t];v(l),localStorage.setItem("favorites",JSON.stringify(l))},g=(t,l)=>{d({open:!0,conversationId:t,title:l})},E=async()=>{if(u.conversationId)try{await P(u.conversationId),await c(),d({open:!1,conversationId:null,title:""})}catch(t){console.error("ëŒ€í™” ì‚­ì œ ì‹¤íŒ¨:",t),await c(),d({open:!1,conversationId:null,title:""})}},y=()=>{d({open:!1,conversationId:null,title:""})},C=w.filter(t=>m.includes(t.conversationId)),I=w.filter(t=>!m.includes(t.conversationId));return e.jsxs(e.Fragment,{children:[u.open&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:y}),e.jsx("div",{className:`relative flex flex-col focus:outline-none text-text-100 text-left shadow-xl 
            rounded-2xl p-6 align-middle bg-bg-100 
            min-w-0 w-full max-w-md animate-[zoom_250ms_ease-in_forwards]`,children:e.jsxs("div",{className:"min-h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-4 justify-between",children:[e.jsx("h2",{className:"font-xl-bold text-text-100 flex w-full min-w-0 items-center leading-6 break-words",children:e.jsx("span",{className:"[overflow-wrap:anywhere]",children:"ëŒ€í™” ì‚­ì œ"})}),e.jsx("button",{onClick:y,className:"p-1 rounded hover:bg-bg-300 transition-colors",children:e.jsx(L,{size:20})})]}),e.jsxs("div",{className:"mt-1 mb-2",children:["ì´ ëŒ€í™”ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",u.title&&e.jsxs("div",{className:"mt-2 text-sm text-text-300",children:['"',u.title,'"']})]}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2 sm:flex-row justify-end",children:[e.jsx("button",{onClick:y,className:`inline-flex items-center justify-center relative h-9 px-4 py-2 rounded-lg 
                    min-w-[5rem] text-text-100 font-medium 
                    bg-bg-300 hover:bg-bg-400 transition duration-100 active:scale-[0.985]`,type:"button",children:"ì·¨ì†Œ"}),e.jsx("button",{onClick:E,className:`inline-flex items-center justify-center relative h-9 px-4 py-2 rounded-lg 
                    min-w-[5rem] bg-red-600 text-white font-medium transition 
                    hover:bg-red-700 hover:scale-[1.02] active:scale-[0.985]`,type:"button",children:"ì‚­ì œ"})]})]})})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden",onClick:i}),e.jsxs($.nav,{animate:{width:x?r?"75vw":288:0,opacity:x?1:0},transition:{type:"tween",ease:"easeInOut",duration:.2},className:`h-screen flex flex-col gap-3 pb-2 px-0 fixed top-0 left-0
          shadow-lg bg-bg-200 z-50 overflow-hidden`,style:{width:x?r?"75vw":"288px":"0px"},"aria-label":"ì‚¬ì´ë“œë°”",children:[e.jsxs("div",{className:"flex w-full items-center gap-px p-2",children:[e.jsx("button",{onClick:i,className:"h-8 w-8 rounded-md hover:bg-bg-300 flex items-center justify-center transition-colors","aria-label":"ì‚¬ì´ë“œë°” ë‹«ê¸°",children:e.jsx(R,{size:20})}),e.jsx(S,{to:"/",className:"flex items-center ml-2",children:e.jsx("span",{className:"text-xl font-semibold text-text-100",children:" ì™¸ì‹ ê¸°ì‚¬"})})]}),e.jsx("div",{className:"flex flex-col px-1.5 pt-0.5 gap-px mb-2",children:e.jsx("button",{onClick:()=>{const t=h.pathname.split("/"),l=t[t.length-1];if(l&&l!=="chat"){const n=`conv:${l}`;localStorage.removeItem(n),console.log(`ðŸ—‘ï¸ í˜„ìž¬ ëŒ€í™” ìºì‹œ ì‚­ì œ: ${n}`)}localStorage.removeItem("pendingMessage"),localStorage.removeItem("pendingConversationId"),Object.keys(sessionStorage).forEach(n=>{n.startsWith("processed_")&&sessionStorage.removeItem(n)}),console.log("ðŸ”„ ìƒˆ ì±„íŒ… ì‹œìž‘ - ì´ì „ ëŒ€í™” ê¸°ë¡ ì •ë¦¬ ì™„ë£Œ"),r&&i&&i(),window.location.href=`/${s.toLowerCase()}`},className:`group flex items-center h-9 px-2.5 py-2 rounded-lg 
            hover:bg-accent-main-100/[0.08] active:bg-accent-main-100/[0.15]
            transition-all ease-in-out active:scale-[0.985] w-full text-left`,children:e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx("div",{className:`w-6 h-6 flex items-center justify-center rounded-full 
              bg-accent-main-100 group-hover:bg-accent-main-100 
              group-hover:shadow-md group-hover:scale-110 group-hover:-rotate-3
              group-active:rotate-6 group-active:scale-[0.98]
              transition-all ease-in-out`,children:e.jsx(U,{size:12,className:"text-white group-hover:scale-105 transition"})}),e.jsx("span",{className:"text-sm font-medium text-accent-main-100 tracking-tight",children:"ìƒˆ ì±„íŒ…"})]})})}),e.jsx("div",{className:"flex flex-grow flex-col overflow-y-auto overflow-x-hidden relative px-2 mb-2",children:p?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-accent-main-100 border-t-transparent"})}):e.jsxs(e.Fragment,{children:[C.length>0&&e.jsxs("div",{className:"flex flex-col mb-6",children:[e.jsx("h3",{className:`text-text-300 pb-2 mt-1 text-xs select-none pl-2 sticky top-0 z-10 
                  bg-gradient-to-b from-bg-200 from-50% to-bg-200/40`,children:"ì¦ê²¨ì°¾ê¸°"}),e.jsx("ul",{className:"flex flex-col gap-px",children:C.map(t=>e.jsx(k,{conversation:t,isActive:h.pathname.includes(t.conversationId),isFavorite:!0,onToggleFavorite:()=>a(t.conversationId),selectedEngine:s,loadConversations:c,onDelete:g},t.conversationId))})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h3",{className:`text-text-300 pb-2 mt-1 text-xs select-none pl-2 sticky top-0 z-10 
                bg-gradient-to-b from-bg-200 from-50% to-bg-200/40`,children:"ìµœê·¼ í•­ëª©"}),e.jsx("ul",{className:"flex flex-col gap-px",children:I.length>0?I.map(t=>e.jsx(k,{conversation:t,isActive:h.pathname.includes(t.conversationId),isFavorite:!1,onToggleFavorite:()=>a(t.conversationId),selectedEngine:s,loadConversations:c,onDelete:g,onToggle:i,isMobile:r},t.conversationId)):e.jsx("li",{className:"text-text-300 text-sm px-4 py-2",children:"ëŒ€í™”ê°€ ì—†ìŠµë‹ˆë‹¤"})})]})]})}),e.jsx("div",{className:"px-2 pb-1",children:e.jsxs("button",{className:"flex items-center gap-3 w-full h-12 px-2 rounded-lg hover:bg-bg-300 transition-colors",type:"button",children:[e.jsx("div",{className:"flex-shrink-0 flex size-8 items-center justify-center rounded-full bg-bg-400",children:e.jsx(_,{size:16,className:"text-text-300"})}),e.jsxs("div",{className:"flex flex-col items-start flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm font-medium text-text-100 truncate w-full text-left",children:"ì‚¬ìš©ìž"}),e.jsx("span",{className:"text-xs text-text-300 truncate w-full text-left",children:"AI Engine"})]})]})})]})]})}),k=({conversation:s,isActive:x,isFavorite:i,onToggleFavorite:j,selectedEngine:h,loadConversations:w,onDelete:N,onToggle:m,isMobile:v})=>{const[p,f]=o.useState(!1),[u,d]=o.useState(!1),[r,b]=o.useState(s.title||"");o.useEffect(()=>{const a=g=>{p&&!g.target.closest(".options-dropdown")&&!g.target.closest(".options-button")&&f(!1)};return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[p]);const c=async()=>{if(r.trim())try{await A(s.conversationId,r),await w(),d(!1)}catch(a){console.error("ì œëª© ìˆ˜ì • ì‹¤íŒ¨:",a),d(!1)}};return u?e.jsx("li",{className:"relative px-3 py-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:r,onChange:a=>b(a.target.value),onKeyPress:a=>{a.key==="Enter"&&c()},className:`flex-1 px-2 py-1 text-sm bg-bg-300 border border-bg-400 
              rounded text-text-100 focus:outline-none focus:border-accent-main-100`,autoFocus:!0}),e.jsx("button",{onClick:c,className:"p-1 hover:bg-bg-400 rounded",children:e.jsx(H,{size:14,className:"text-green-500"})}),e.jsx("button",{onClick:()=>{d(!1),b(s.title||"")},className:"p-1 hover:bg-bg-400 rounded",children:e.jsx(L,{size:14,className:"text-red-500"})})]})}):e.jsxs("li",{className:"relative group",children:[e.jsxs(S,{to:`/${h.toLowerCase()}/chat/${s.conversationId}`,className:`flex items-center gap-3 h-8 px-3 rounded-md text-xs
          hover:bg-bg-400 transition-colors relative
          ${x?"bg-bg-400 text-text-100":"text-text-300 hover:text-text-100"}`,onClick:()=>{console.log("ðŸ”— ìŠ¤ë ˆë“œ í´ë¦­:",{conversationId:s.conversationId,targetUrl:`/${h.toLowerCase()}/chat/${s.conversationId}`,currentUrl:window.location.pathname,isMobile:v}),v&&m&&setTimeout(()=>{m()},100)},children:[i&&e.jsx(J,{size:12,className:"flex-shrink-0 fill-current"}),e.jsx("span",{className:"truncate text-sm flex-1",children:s.title||"ì œëª© ì—†ìŒ"}),e.jsx("button",{onClick:a=>{a.preventDefault(),a.stopPropagation(),f(!p)},className:`options-button opacity-0 group-hover:opacity-100 transition-opacity
            h-6 w-6 rounded flex items-center justify-center hover:bg-bg-300`,children:e.jsx(W,{size:14})})]}),p&&e.jsxs("div",{className:`options-dropdown absolute right-0 top-8 bg-bg-100 
          rounded-lg shadow-lg z-20 py-1 min-w-[150px] border border-bg-300`,children:[e.jsxs("button",{onClick:()=>{d(!0),f(!1)},className:`w-full text-left px-3 py-1.5 text-sm hover:bg-bg-200 transition-colors
              flex items-center gap-2`,children:[e.jsx(K,{size:12}),"ì œëª© ìˆ˜ì •"]}),e.jsx("button",{onClick:()=>{j(),f(!1)},className:"w-full text-left px-3 py-1.5 text-sm hover:bg-bg-200 transition-colors",children:i?"ì¦ê²¨ì°¾ê¸° ì œê±°":"ì¦ê²¨ì°¾ê¸° ì¶”ê°€"}),e.jsx("button",{onClick:()=>{N(s.conversationId,s.title),f(!1)},className:"w-full text-left px-3 py-1.5 text-sm hover:bg-bg-200 transition-colors text-red-500",children:"ì‚­ì œ"})]})]})};O.displayName="Sidebar";export{O as default};
//# sourceMappingURL=Sidebar-75592b86.js.map
