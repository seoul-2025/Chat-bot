# 멀티테넌트 시스템 시연 시나리오

## 📋 시연 개요
AWS 기반 멀티테넌트 AI 칼럼 작성 서비스의 테넌트별 사용자 관리 및 할당량 제어 시연

## 🎯 주요 시연 포인트

### 1. 멀티테넌트 구조
- **5개 신문사 테넌트 관리**
  - 서울경제신문 (Enterprise)
  - 조선일보 (Pro)
  - 한국경제신문 (Pro)
  - 중앙일보 (Basic)
  - 데모신문사 (Free)

### 2. 플랜별 차별화
| 플랜 | 월 토큰 한도 | 사용 가능 엔진 | 최대 사용자 |
|------|------------|---------------|-----------|
| Enterprise | 1000만 | C1, C2, C7 | 100명 |
| Pro | 500만 | C1, C7 | 50명 |
| Basic | 100만 | C1 | 20명 |
| Free | 10만 | C1 | 5명 |

## 📊 시연 순서

### Step 1: 관리 대시보드 접속
```bash
# 대시보드 열기
open /Users/yeong-gwang/Documents/work/서울경제신문/DEV/Sedailyio/칼럼/sedaily_\ column/admin-dashboard/index.html
```

### Step 2: 전체 현황 확인
1. **전체 현황** 탭 클릭
2. 총 5개 테넌트, 15명 사용자 확인
3. 한도 임박 사용자 3명 확인

### Step 3: 테넌트별 관리
1. **테넌트 관리** 탭 클릭
2. 각 신문사별 플랜과 설정 확인
3. 서울경제 → Enterprise 플랜 → 모든 엔진 사용 가능
4. 데모신문사 → Free 플랜 → C1 엔진만 사용 가능

### Step 4: 사용자별 할당량 관리
1. **사용자 관리** 탭 클릭
2. 테넌트 필터로 "서울경제신문" 선택
3. 사용자별 사용량 확인:
   - 이기자: 45% (안전)
   - 박기자: 80% (주의)
   - **정인턴: 95% (위험)**

### Step 5: 🔴 할당량 초과 시연
1. **정인턴 (95% 사용)** 찾기
2. "차단" 버튼 클릭
3. 확인 모달에서 "차단하기" 클릭
4. **→ "더 이상 채팅을 사용할 수 없습니다" 알림**
5. 상태가 "차단됨"으로 변경 확인

### Step 6: 사용량 모니터링
1. **사용량 모니터링** 탭 클릭
2. 경고 알림 확인:
   - 정인턴: 95% 사용
   - 데모관리자: 95% 사용
3. 플랜별 평균 사용률 확인
4. 사용량 상위 5명 확인

## 💡 핵심 시연 포인트

### A. 테넌트 격리
- 각 신문사는 독립된 테넌트로 관리
- 사용자와 데이터가 완전히 분리

### B. 플랜별 기능 제한
- Enterprise: 모든 AI 엔진 (C1, C2, C7) 사용 가능
- Free: C1 엔진만 사용 가능

### C. 실시간 할당량 제어
- 사용량 95% 도달 시 경고
- 100% 도달 시 자동 차단 가능
- **차단된 사용자는 채팅 불가**

### D. 세밀한 사용자 관리
- 테넌트별 사용자 관리
- 개별 사용자 플랜 설정
- 역할 기반 접근 제어 (Admin/User)

## 📱 실제 서비스 연동 시나리오

### 1. 사용자가 채팅 시도
```javascript
// Lambda에서 사용량 체크
const usage = await checkUserUsage(userId);
if (usage >= 100) {
    return {
        statusCode: 403,
        body: JSON.stringify({
            error: "할당량을 초과했습니다. 관리자에게 문의하세요."
        })
    };
}
```

### 2. 할당량 차단 메시지
```
"죄송합니다. 이번 달 사용 한도를 초과하셨습니다.
추가 사용을 원하시면 관리자에게 문의해주세요.

현재 플랜: Free
월 한도: 10,000 토큰
사용량: 10,000 토큰 (100%)"
```

## 🔧 기술 구현 세부사항

### Backend (AWS)
- **DynamoDB**: 테넌트, 사용자, 사용량 데이터 저장
- **Lambda**: 멀티테넌트 API 처리
- **API Gateway**: REST API 엔드포인트
- **Cognito**: 사용자 인증 (선택적)

### 테이블 구조
1. **sedaily-column-tenants**: 테넌트 정보
2. **sedaily-column-user-tenants**: 사용자-테넌트 매핑
3. **sedaily-column-usage**: 사용량 추적

### 할당량 체크 로직
```python
def check_quota(user_id, plan):
    usage = get_current_usage(user_id)
    limit = PLAN_LIMITS[plan]

    if usage >= limit:
        block_user(user_id)
        return False
    elif usage >= limit * 0.9:
        send_warning(user_id)

    return True
```

## 🎬 시연 스크립트

### 오프닝
"안녕하세요. 오늘은 멀티테넌트 AI 칼럼 작성 서비스의 관리 시스템을 시연해드리겠습니다."

### 테넌트 소개
"현재 5개 신문사가 우리 서비스를 사용하고 있습니다.
서울경제는 Enterprise 플랜으로 모든 기능을 사용할 수 있고,
데모신문사는 Free 플랜으로 기본 기능만 사용 가능합니다."

### 할당량 관리
"각 사용자별로 사용량을 실시간 모니터링하고 있습니다.
보시는 것처럼 정인턴님이 95% 사용량에 도달했네요."

### 차단 시연
"이제 한도를 초과한 사용자를 차단해보겠습니다.
(차단 버튼 클릭)
차단된 사용자는 더 이상 채팅 서비스를 이용할 수 없습니다."

### 클로징
"이렇게 테넌트별, 사용자별, 플랜별로 세밀하게 관리할 수 있어
효율적인 서비스 운영이 가능합니다."

## 📌 추가 시연 가능 항목

1. **실시간 사용량 업데이트**
   - WebSocket을 통한 실시간 모니터링

2. **플랜 업그레이드**
   - Free → Basic → Pro → Enterprise

3. **테넌트 추가**
   - 새로운 신문사 온보딩

4. **사용량 리포트**
   - 월별/일별 사용량 통계
   - CSV 내보내기

5. **알림 시스템**
   - 80% 도달 시 이메일 알림
   - 100% 도달 시 자동 차단 알림

---

## 🚀 시연 준비 체크리스트

- [x] DynamoDB 테이블 생성
- [x] 샘플 데이터 입력 (5개 테넌트, 15명 사용자)
- [x] Lambda 함수 배포
- [x] 관리 대시보드 구현
- [x] 할당량 제어 로직 구현
- [x] 시연 시나리오 작성

## 💬 예상 질문 & 답변

**Q: 실제로 차단된 사용자가 채팅을 시도하면?**
A: Lambda 함수에서 사용량을 체크하여 403 Forbidden을 반환합니다.

**Q: 플랜 변경은 어떻게?**
A: 관리자가 대시보드에서 즉시 변경 가능하며, 다음 요청부터 적용됩니다.

**Q: 사용량은 어떻게 계산?**
A: 입력/출력 토큰을 실시간으로 계산하여 DynamoDB에 저장합니다.

---

**시연 시간: 약 10-15분**